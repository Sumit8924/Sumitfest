<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Reset Password | FESTRONIX 2.0 (Bootstrap O(1))</title>
    
    <!-- BOOTSTRAP 5 + ICONS + FONTS – O(1) LAYOUT -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Orbitron:wght@400;600;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ========== O(1) THEME – minimal, direct, no complex loops ========== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #000;
            font-family: 'Rajdhani', sans-serif;
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }
        /* ----- VIDEO BACKGROUND ----- */
        .video-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: -2;
            overflow: hidden;
        }
        .video-background video {
            position: absolute; top: 50%; left: 50%; min-width: 100%; min-height: 100%;
            transform: translate(-50%, -50%); object-fit: cover;
        }
        .video-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.7); z-index: -1; }
        
        /* ----- CURSOR (O(1) direct) ----- */
        .cursor, .cursor-dot {
            position: fixed; pointer-events: none; z-index: 10000;
            transform: translate(-50%, -50%); mix-blend-mode: difference;
        }
        .cursor { width: 20px; height: 20px; border: 2px solid #ff4733; border-radius: 50%; transition: all 0.1s; }
        .cursor-dot { width: 6px; height: 6px; background: #ffcc33; border-radius: 50%; }

        /* ----- LOADER – O(1) constant ----- */
        .loader-container {
            position: fixed; inset: 0; background: linear-gradient(135deg, #0a0a0a, #1a1a2e);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 9999; transition: opacity 0.5s, visibility 0.5s;
        }
        .loader-hidden { opacity: 0; visibility: hidden; }
        .loader-letter {
            font-family: 'Orbitron', sans-serif; font-size: 4rem; font-weight: 900;
            color: #ff4733; text-shadow: 0 0 15px rgba(255,71,51,0.7); opacity: 0;
            animation: letterReveal 0.3s forwards; margin: 0 3px;
        }
        @keyframes letterReveal { to { opacity: 1; text-shadow: 0 0 20px #ff4733; } }
        .loader-wrapper { display: flex; flex-wrap: wrap; justify-content: center; }
        .loader {
            position: absolute; bottom: -30px; width: 100%; height: 4px;
            background: linear-gradient(90deg, transparent, #ffcc33, transparent);
            animation: loadingBar 2.5s ease-in-out forwards;
        }
        @keyframes loadingBar { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }

        /* ----- MAIN CARD – GLASS 3D ----- */
        .forgot-card {
            background: rgba(0,0,0,0.8); backdrop-filter: blur(15px);
            border-radius: 20px; padding: 2.5rem; max-width: 500px; width: 100%;
            border: 2px solid rgba(255,71,51,0.3);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            position: relative; overflow: hidden;
        }
        .forgot-card::before {
            content: ''; position: absolute; inset: -2px;
            background: linear-gradient(45deg, #ff2a00, #3366ff, #33ff66, #ff33cc, #ff2a00);
            z-index: -1; border-radius: 22px; opacity: 0; filter: blur(10px);
            transition: opacity 0.4s;
        }
        .forgot-card:hover::before { opacity: 0.3; animation: border-rotate 3s linear infinite; }
        @keyframes border-rotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ----- LOGO ----- */
        .logo-header img { width: 120px; filter: drop-shadow(0 0 15px rgba(255,71,51,0.7)); }
        .logo-header h1 {
            font-family: 'Orbitron', sans-serif; font-size: 2.5rem;
            background: linear-gradient(135deg, #ff4733, #ffcc33, #ff9966);
            -webkit-background-clip: text; background-clip: text; color: transparent;
        }

        /* ----- PROGRESS STEPS (O(1) constant) ----- */
        .progress-steps { position: relative; display: flex; justify-content: space-between; margin-bottom: 2rem; }
        .progress-steps::before {
            content: ''; position: absolute; top: 25px; left: 10%; right: 10%;
            height: 4px; background: rgba(255,153,102,0.2); z-index: 1;
        }
        .progress-bar-custom {
            position: absolute; top: 25px; left: 10%; height: 4px;
            background: linear-gradient(90deg, #ff4733, #ffcc33); z-index: 2;
            transition: width 0.5s ease; width: 33%;
        }
        .step { position: relative; z-index: 3; text-align: center; flex: 1; }
        .step-number {
            width: 50px; height: 50px; border-radius: 50%; background: rgba(0,0,0,0.8);
            border: 3px solid rgba(255,153,102,0.3); display: flex; align-items: center;
            justify-content: center; margin: 0 auto 10px; font-size: 1.2rem; color: #ff9966;
        }
        .step.active .step-number { background: linear-gradient(135deg, #ff4733, #ffcc33); border-color: #ffcc33; color: #000; box-shadow: 0 0 20px rgba(255,71,51,0.5); }
        .step.completed .step-number { background: linear-gradient(135deg, #33ff66, #00cc66); border-color: #33ff66; color: #000; }
        .step-label { font-size: 0.9rem; color: #ccc; }
        .step.active .step-label { color: #ffcc33; }

        /* ----- FORMS ----- */
        .forgot-form { display: none; }
        .forgot-form.active { display: block; animation: fadeInUp 0.6s; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .form-label { color: #ff9966; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        .form-input {
            width: 100%; background: rgba(0,0,0,0.6); border: 2px solid rgba(255,153,102,0.3);
            border-radius: 12px; padding: 0.9rem 1.2rem; color: white; font-size: 1.1rem;
            transition: 0.3s;
        }
        .form-input:focus { border-color: #ff9966; box-shadow: 0 0 20px rgba(255,153,102,0.4); outline: none; }

        /* ----- OTP INPUTS ----- */
        .otp-container { display: flex; gap: 10px; justify-content: center; margin: 20px 0; }
        .otp-input {
            width: 50px; height: 60px; background: rgba(0,0,0,0.6); border: 2px solid rgba(255,153,102,0.3);
            border-radius: 8px; text-align: center; font-size: 1.5rem; font-family: 'Orbitron', sans-serif;
            color: #ffcc33; transition: 0.3s;
        }
        .otp-input:focus { border-color: #ff9966; box-shadow: 0 0 15px rgba(255,153,102,0.4); outline: none; }

        /* ----- BUTTONS 3D ----- */
        .btn-3d-primary {
            background: linear-gradient(135deg, #ff2a00, #ff6600, #ffcc33);
            color: white; border: none; border-radius: 12px; padding: 1rem 2rem;
            font-family: 'Orbitron', sans-serif; font-weight: 700; letter-spacing: 2px;
            transition: 0.3s; box-shadow: 0 10px 30px rgba(255,42,0,0.4);
            transform: translateY(-3px) rotateX(5deg);
        }
        .btn-3d-primary:hover { transform: translateY(-6px) rotateX(10deg); box-shadow: 0 15px 40px rgba(255,42,0,0.6); }
        .btn-3d-secondary {
            background: linear-gradient(135deg, #3366ff, #9933ff); color: white;
            border: none; border-radius: 12px; padding: 1rem 2rem;
            box-shadow: 0 10px 30px rgba(51,102,255,0.4);
        }
        .btn-3d-success {
            background: linear-gradient(135deg, #33ff66, #00cc66); color: #0a0a1a;
            border: none; border-radius: 12px; padding: 1rem 2rem;
        }

        /* ----- PASSWORD STRENGTH ----- */
        .strength-bar { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin: 10px 0; }
        .strength-fill { height: 100%; width: 0; background: #ff4733; border-radius: 3px; transition: 0.3s; }

        /* ----- SUCCESS MESSAGE ----- */
        .success-message { display: none; text-align: center; padding: 1.5rem; }
        .success-message.active { display: block; animation: fadeInUp 0.6s; }
        .success-icon { font-size: 4rem; color: #33ff66; animation: bounce 1s infinite alternate; }
        @keyframes bounce { 0% { transform: translateY(0); } 100% { transform: translateY(-10px); } }

        /* ----- ERROR ----- */
        .error-message { display: none; background: rgba(255,71,51,0.1); border: 2px solid #ff4733; border-radius: 10px; padding: 1rem; margin-bottom: 1.5rem; }
        .error-message.active { display: flex; animation: shake 0.5s; }
        @keyframes shake { 0%,100% { transform: translateX(0); } 20%,60% { transform: translateX(-5px); } 40%,80% { transform: translateX(5px); } }

        /* ----- NOTIFICATION ----- */
        .notification {
            position: fixed; top: 100px; right: 20px; padding: 1rem 1.8rem;
            border-radius: 8px; display: flex; align-items: center; gap: 12px;
            z-index: 10000; animation: slideIn 0.3s; color: white; font-weight: 600;
        }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* ----- RESPONSIVE ----- */
        @media (max-width: 768px) {
            .loader-letter { font-size: 2.5rem; }
            .forgot-card { padding: 1.8rem; }
            .logo-header h1 { font-size: 2rem; }
        }
        @media (max-width: 480px) {
            .otp-input { width: 40px; height: 50px; font-size: 1.2rem; }
            .step-number { width: 40px; height: 40px; font-size: 1rem; }
        }
        /* hide cursor on touch */
        @media (hover: none) and (pointer: coarse) { .cursor, .cursor-dot { display: none !important; } }
    </style>
</head>
<body>
    <!-- VIDEO BACKGROUND -->
    <div class="video-background">
        <video autoplay muted loop playsinline><source src="light.mp4" type="video/mp4"></video>
        <div class="video-overlay"></div>
    </div>

    <!-- CURSOR (O(1) direct update) -->
    <div class="cursor"></div>
    <div class="cursor-dot"></div>

    <!-- LOADER – hide after 3s -->
    <div class="loader-container" id="loader">
        <div class="loader-wrapper">
            <span class="loader-letter">R</span><span class="loader-letter">E</span><span class="loader-letter">S</span><span class="loader-letter">E</span><span class="loader-letter">T</span>
            <span class="loader-letter"> </span>
            <span class="loader-letter">P</span><span class="loader-letter">A</span><span class="loader-letter">S</span><span class="loader-letter">S</span><span class="loader-letter">W</span>
            <span class="loader-letter">O</span><span class="loader-letter">R</span><span class="loader-letter">D</span>
            <div class="loader"></div>
        </div>
        <div class="loader-subtitle text-warning mt-4">SECURE PASSWORD RECOVERY</div>
    </div>

    <!-- MAIN CONTENT – BOOTSTRAP FLEX O(1) -->
    <div class="container d-flex align-items-center justify-content-center min-vh-100 py-4">
        <div class="forgot-card">
            <!-- LOGO HEADER -->
            <div class="logo-header text-center mb-4">
                <img src="Fest4.png" alt="FESTRONIX 2.0" class="img-fluid" onerror="this.style.display='none'">
                <h1 class="mt-3">FESTRONIX 2.0</h1>
                <p class="text-warning">GIFT Autonomous College</p>
            </div>

            <!-- PROGRESS STEPS (O(1) static) -->
            <div class="progress-steps">
                <div class="progress-bar-custom" id="progressBar" style="width: 33%"></div>
                <div class="step active" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-label">Verify Email</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-label">Enter OTP</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-label">New Password</div>
                </div>
            </div>

            <!-- ERROR MESSAGE -->
            <div class="error-message" id="errorMessage">
                <i class="fas fa-exclamation-circle fs-4 me-3" style="color:#ff4733;"></i>
                <div class="error-text text-warning" id="errorText">Error message will appear here</div>
            </div>

            <!-- STEP 1: EMAIL FORM -->
            <div class="forgot-form active" id="step1Form">
                <div class="text-center mb-4">
                    <h2 class="text-warning fs-1 fw-bold" style="font-family:Orbitron;">Reset Your Password</h2>
                    <p class="text-white-50">Enter your registered email address to receive a verification code</p>
                </div>
                <form id="emailForm">
                    <div class="mb-4">
                        <label class="form-label mb-2"><i class="fas fa-envelope me-2"></i> Email Address</label>
                        <div class="position-relative">
                            <input type="email" id="email" class="form-input" placeholder="Enter your email address" required>
                            <i class="fas fa-at position-absolute top-50 end-0 translate-middle-y me-3 text-warning"></i>
                        </div>
                    </div>
                    <button type="submit" class="btn-3d-primary w-100" id="sendOtpBtn">
                        <i class="fas fa-paper-plane me-2"></i> Send Verification Code
                    </button>
                </form>
            </div>

            <!-- STEP 2: OTP FORM -->
            <div class="forgot-form" id="step2Form">
                <div class="text-center mb-4">
                    <h2 class="text-warning fs-1 fw-bold" style="font-family:Orbitron;">Verify Your Identity</h2>
                    <p class="text-white-50">Enter the 6-digit code sent to your email</p>
                </div>
                <form id="otpForm">
                    <div class="mb-3">
                        <label class="form-label mb-2"><i class="fas fa-key me-2"></i> Verification Code</label>
                        <div class="otp-container">
                            <input type="text" class="otp-input" maxlength="1" data-index="0">
                            <input type="text" class="otp-input" maxlength="1" data-index="1">
                            <input type="text" class="otp-input" maxlength="1" data-index="2">
                            <input type="text" class="otp-input" maxlength="1" data-index="3">
                            <input type="text" class="otp-input" maxlength="1" data-index="4">
                            <input type="text" class="otp-input" maxlength="1" data-index="5">
                        </div>
                        <input type="hidden" id="fullOtp" name="otp">
                    </div>
                    <div class="resend-timer text-center text-warning mb-4">
                        <span id="timerText">Resend code in <span id="countdown">60</span> seconds</span>
                        <a href="#" id="resendLink" style="display:none; color:#ffcc33;">Resend Code</a>
                    </div>
                    <button type="submit" class="btn-3d-secondary w-100" id="verifyOtpBtn">
                        <i class="fas fa-check-circle me-2"></i> Verify Code
                    </button>
                </form>
            </div>

            <!-- STEP 3: NEW PASSWORD FORM -->
            <div class="forgot-form" id="step3Form">
                <div class="text-center mb-4">
                    <h2 class="text-warning fs-1 fw-bold" style="font-family:Orbitron;">Create New Password</h2>
                    <p class="text-white-50">Enter a strong password you haven't used before</p>
                </div>
                <form id="passwordForm">
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-lock me-2"></i> New Password</label>
                        <div class="position-relative">
                            <input type="password" id="newPassword" class="form-input" placeholder="Enter new password" required>
                            <i class="fas fa-eye position-absolute top-50 end-0 translate-middle-y me-3 text-warning" id="togglePassword" style="cursor:pointer;"></i>
                        </div>
                        <div class="strength-bar mt-2">
                            <div class="strength-fill" id="strengthFill"></div>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span class="text-white-50">Password Strength:</span>
                            <span id="strengthValue" style="color:#ff4733;">Weak</span>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="form-label"><i class="fas fa-lock me-2"></i> Confirm Password</label>
                        <div class="position-relative">
                            <input type="password" id="confirmPassword" class="form-input" placeholder="Confirm new password" required>
                            <i class="fas fa-eye position-absolute top-50 end-0 translate-middle-y me-3 text-warning" id="toggleConfirmPassword" style="cursor:pointer;"></i>
                        </div>
                    </div>
                    <button type="submit" class="btn-3d-success w-100" id="resetPasswordBtn">
                        <i class="fas fa-sync-alt me-2"></i> Reset Password
                    </button>
                </form>
            </div>

            <!-- SUCCESS MESSAGE -->
            <div class="success-message" id="successMessage">
                <div class="success-icon"><i class="fas fa-check-circle"></i></div>
                <h2 class="text-warning mt-3" style="font-family:Orbitron;">Password Reset Successful!</h2>
                <p class="text-white-50">Your password has been successfully reset.</p>
                <p class="text-white-50">You can now login with your new password.</p>
                <a href="login.html" class="btn-3d-primary d-inline-block mt-4 text-decoration-none">
                    <i class="fas fa-sign-in-alt me-2"></i> Go to Login
                </a>
            </div>

            <!-- BACK TO LOGIN LINK -->
            <div class="back-to-login text-center mt-4 pt-3 border-top border-secondary">
                <p class="text-white-50 mb-0">Remember your password? <a href="login.html" class="text-warning text-decoration-none"><i class="fas fa-arrow-left me-1"></i> Back to Login</a></p>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="footer-3d py-4 text-center" style="border-top: 2px solid rgba(255,153,102,0.3);">
        <div class="container">
            <p class="text-white-50 mb-1">© 2026 FESTRONIX 2.0. All Rights Reserved.</p>
            <p class="text-warning small mb-0">GIFT Autonomous College, Bhubaneswar</p>
        </div>
    </footer>

    <!-- O(1) JAVASCRIPT – CONSTANT-TIME FORGOT PASSWORD LOGIC -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        (function() {
            "use strict";
            // ========== O(1) CONSTANT-TIME OPERATIONS – NO LOOPS, DIRECT ASSIGNMENTS ==========

            // ----- CURSOR (O(1) direct animation) -----
            const cursor = document.querySelector('.cursor'), cursorDot = document.querySelector('.cursor-dot');
            if (cursor && cursorDot) {
                let mx = 0, my = 0, cx = 0, cy = 0, dx = 0, dy = 0;
                document.addEventListener('mousemove', (e) => { mx = e.clientX; my = e.clientY; });
                function animate() {
                    cx += (mx - cx) * 0.15; cy += (my - cy) * 0.15;
                    dx += (mx - dx) * 0.3; dy += (my - dy) * 0.3;
                    cursor.style.left = cx + 'px'; cursor.style.top = cy + 'px';
                    cursorDot.style.left = dx + 'px'; cursorDot.style.top = dy + 'px';
                    requestAnimationFrame(animate);
                }
                animate();
                // hover effect (static listeners)
                document.querySelectorAll('a, button, .btn-3d-primary, .form-input, .otp-input').forEach(el => {
                    el.addEventListener('mouseenter', () => { cursor.style.transform = 'translate(-50%, -50%) scale(1.5)'; cursor.style.borderColor = '#ffcc33'; });
                    el.addEventListener('mouseleave', () => { cursor.style.transform = 'translate(-50%, -50%) scale(1)'; cursor.style.borderColor = '#ff4733'; });
                });
                document.addEventListener('click', () => {
                    cursor.style.transform = 'translate(-50%, -50%) scale(0.8)';
                    setTimeout(() => cursor.style.transform = 'translate(-50%, -50%) scale(1)', 100);
                });
                if ('ontouchstart' in window) { cursor.style.display = 'none'; cursorDot.style.display = 'none'; }
            }

            // ----- LOADER – hide after 3s -----
            setTimeout(() => { document.getElementById('loader')?.classList.add('loader-hidden'); }, 3000);

            // ----- STATE (O(1) global variables) -----
            let currentStep = 1, userEmail = '', countdownInterval = null;
            const step1Form = document.getElementById('step1Form'), step2Form = document.getElementById('step2Form'),
                  step3Form = document.getElementById('step3Form'), successMsg = document.getElementById('successMessage'),
                  errorMsg = document.getElementById('errorMessage'), errorText = document.getElementById('errorText'),
                  progressBar = document.getElementById('progressBar'), step1 = document.getElementById('step1'),
                  step2 = document.getElementById('step2'), step3 = document.getElementById('step3');

            // ----- UTILITIES (O(1)) -----
            function validateEmail(e) { return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e); }
            function showError(msg) { errorText.textContent = msg; errorMsg.classList.add('active'); setTimeout(() => errorMsg.classList.remove('active'), 5000); }
            function hideError() { errorMsg.classList.remove('active'); }
            function showNotification(msg, type) {
                const old = document.querySelector('.notification'); if(old) old.remove();
                const n = document.createElement('div'); n.className = 'notification';
                n.style.background = type==='success' ? 'rgba(51,255,102,0.9)' : 'rgba(255,71,51,0.9)';
                n.innerHTML = `<i class="fas ${type==='success'?'fa-check-circle':'fa-exclamation-circle'}"></i><span>${msg}</span>`;
                document.body.appendChild(n);
                setTimeout(() => { n.style.animation = 'slideOut 0.3s forwards'; setTimeout(() => n.remove(), 300); }, 2800);
            }

            // ----- STEP NAVIGATION (O(1)) -----
            function nextStep() {
                if (currentStep < 3) {
                    document.getElementById(`step${currentStep}Form`).classList.remove('active');
                    currentStep++;
                    progressBar.style.width = ((currentStep-1)/2)*100 + '%';
                    [step1, step2, step3].forEach((s,i) => {
                        s.classList.remove('active','completed');
                        if (i+1 < currentStep) s.classList.add('completed');
                        else if (i+1 === currentStep) s.classList.add('active');
                    });
                    document.getElementById(`step${currentStep}Form`).classList.add('active');
                    hideError();
                }
            }
            function showSuccess() {
                step1Form.classList.remove('active'); step2Form.classList.remove('active'); step3Form.classList.remove('active');
                successMsg.classList.add('active'); progressBar.style.width = '100%';
                step1.classList.add('completed'); step2.classList.add('completed'); step3.classList.add('completed');
                step1.classList.remove('active'); step2.classList.remove('active'); step3.classList.remove('active');
            }

            // ----- OTP INPUT HANDLING (O(1) direct) -----
            const otpInputs = document.querySelectorAll('.otp-input');
            const fullOtp = document.getElementById('fullOtp');
            function updateFullOtp() { 
                let otp = ''; 
                otpInputs.forEach(i => otp += i.value); 
                fullOtp.value = otp; 
            }
            if (otpInputs.length) {
                otpInputs.forEach((input, idx) => {
                    input.addEventListener('input', (e) => {
                        e.target.value = e.target.value.replace(/[^0-9]/g, '').slice(0,1);
                        if (e.target.value && idx < 5) otpInputs[idx+1].focus();
                        updateFullOtp();
                    });
                    input.addEventListener('keydown', (e) => {
                        if (e.key === 'Backspace' && !input.value && idx > 0) { otpInputs[idx-1].focus(); }
                        if (e.key === 'ArrowLeft' && idx > 0) otpInputs[idx-1].focus();
                        if (e.key === 'ArrowRight' && idx < 5) otpInputs[idx+1].focus();
                    });
                    input.addEventListener('paste', (e) => {
                        e.preventDefault();
                        const paste = e.clipboardData.getData('text').replace(/[^0-9]/g, '').slice(0,6);
                        if (paste.length === 6) {
                            for (let i=0; i<6; i++) if (otpInputs[i]) otpInputs[i].value = paste[i];
                            otpInputs[5].focus(); updateFullOtp();
                        }
                    });
                });
            }

            // ----- COUNTDOWN (O(1)) -----
            const countdownSpan = document.getElementById('countdown'), timerText = document.getElementById('timerText'), resendLink = document.getElementById('resendLink');
            let countdown = 60;
            function startOtpCountdown() {
                countdown = 60; countdownSpan.textContent = countdown;
                if (countdownInterval) clearInterval(countdownInterval);
                timerText.style.display = 'inline'; resendLink.style.display = 'none';
                countdownInterval = setInterval(() => {
                    countdown--; countdownSpan.textContent = countdown;
                    if (countdown <= 0) { clearInterval(countdownInterval); timerText.style.display = 'none'; resendLink.style.display = 'inline'; }
                }, 1000);
            }

            // ----- PASSWORD STRENGTH (O(1) static) -----
            const pwd = document.getElementById('newPassword'), strengthFill = document.getElementById('strengthFill'), strengthVal = document.getElementById('strengthValue');
            if (pwd) {
                pwd.addEventListener('input', function() {
                    const v = this.value; let s = 0;
                    if (v.length >= 8) s++; if (/[a-z]/.test(v)) s++; if (/[A-Z]/.test(v)) s++; if (/[0-9]/.test(v)) s++; if (/[^A-Za-z0-9]/.test(v)) s++;
                    const p = s * 20;
                    strengthFill.style.width = p + '%';
                    if (s >= 4) { strengthFill.style.background = '#33ff66'; strengthVal.textContent = 'Strong'; strengthVal.style.color = '#33ff66'; }
                    else if (s >= 3) { strengthFill.style.background = '#ffcc33'; strengthVal.textContent = 'Good'; strengthVal.style.color = '#ffcc33'; }
                    else if (s >= 2) { strengthFill.style.background = '#ff9966'; strengthVal.textContent = 'Fair'; strengthVal.style.color = '#ff9966'; }
                    else { strengthFill.style.background = '#ff4733'; strengthVal.textContent = 'Weak'; strengthVal.style.color = '#ff4733'; }
                });
            }

            // ----- PASSWORD TOGGLE -----
            document.getElementById('togglePassword')?.addEventListener('click', function() {
                const p = document.getElementById('newPassword');
                p.type = p.type === 'password' ? 'text' : 'password';
                this.className = `fas ${p.type==='password'?'fa-eye':'fa-eye-slash'} position-absolute top-50 end-0 translate-middle-y me-3 text-warning`;
            });
            document.getElementById('toggleConfirmPassword')?.addEventListener('click', function() {
                const p = document.getElementById('confirmPassword');
                p.type = p.type === 'password' ? 'text' : 'password';
                this.className = `fas ${p.type==='password'?'fa-eye':'fa-eye-slash'} position-absolute top-50 end-0 translate-middle-y me-3 text-warning`;
            });

            // ----- STEP 1: EMAIL SUBMIT (O(1) fetch) -----
            document.getElementById('emailForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('email').value.trim();
                if (!validateEmail(email)) return showError('Please enter a valid email address');
                const btn = document.getElementById('sendOtpBtn');
                const orig = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...'; btn.disabled = true;
                fetch('http://localhost:5000/send-otp', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({email}) })
                .then(res => { if (!res.ok) throw new Error(); return res.json(); })
                .then(data => { if (data.success || data.message) { userEmail = email; nextStep(); startOtpCountdown(); showNotification(data.message || 'Code sent', 'success'); } else throw new Error(); })
                .catch(() => showError('Failed to send verification code'))
                .finally(() => { btn.innerHTML = orig; btn.disabled = false; });
            });

            // ----- STEP 2: OTP SUBMIT -----
            document.getElementById('otpForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                const otp = fullOtp.value;
                if (otp.length !== 6) return showError('Enter complete 6-digit code');
                if (!userEmail) return showError('Session expired. Start over.');
                const btn = document.getElementById('verifyOtpBtn');
                const orig = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying...'; btn.disabled = true;
                fetch('http://localhost:5000/verify-otp', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({email:userEmail, otp}) })
                .then(res => res.json())
                .then(data => { if (data.success || data.valid) { nextStep(); showNotification('OTP verified', 'success'); } else throw new Error(); })
                .catch(() => { showError('Invalid verification code'); otpInputs.forEach(i => i.value = ''); updateFullOtp(); otpInputs[0].focus(); })
                .finally(() => { btn.innerHTML = orig; btn.disabled = false; });
            });

            // ----- RESEND OTP -----
            resendLink?.addEventListener('click', function(e) {
                e.preventDefault();
                if (!userEmail) return showError('Session expired');
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Resending...';
                fetch('http://localhost:5000/send-otp', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({email:userEmail}) })
                .then(res => res.json())
                .then(() => { otpInputs.forEach(i => i.value = ''); updateFullOtp(); otpInputs[0].focus(); timerText.style.display = 'inline'; resendLink.style.display = 'none'; this.innerHTML = 'Resend Code'; startOtpCountdown(); showNotification('New code sent', 'success'); })
                .catch(() => showError('Failed to resend code'))
                .finally(() => { this.innerHTML = 'Resend Code'; });
            });

            // ----- STEP 3: PASSWORD RESET -----
            document.getElementById('passwordForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                const newPwd = document.getElementById('newPassword').value;
                const confirm = document.getElementById('confirmPassword').value;
                if (newPwd.length < 8) return showError('Password must be at least 8 characters');
                if (newPwd !== confirm) return showError('Passwords do not match');
                if (!userEmail) return showError('Session expired');
                const btn = document.getElementById('resetPasswordBtn');
                const orig = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Resetting...'; btn.disabled = true;
                fetch('http://localhost:5000/reset-password', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({email:userEmail, newPassword:newPwd, confirmPassword:confirm}) })
                .then(res => res.json())
                .then(data => { if (data.success) { showSuccess(); showNotification('Password reset successful!', 'success'); } else throw new Error(); })
                .catch(() => showError('Failed to reset password'))
                .finally(() => { btn.innerHTML = orig; btn.disabled = false; });
            });

            // ----- AUTO-FILL REMEMBERED EMAIL? (optional) -----
            const remembered = localStorage.getItem('festronix_user_email');
            if (remembered) document.getElementById('email').value = remembered;
        })();
    </script>
</body>
</html>